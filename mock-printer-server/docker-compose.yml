services:
  mock-printer:
    container_name: mock-printer
    build: .            # Statt ./mock-printer
    environment:
      - HOST_IP=${HOST_IP:-0.0.0.0}  # Kann über .env überschrieben werden
    networks:
      - printer-network
    ports:
      - "8883:8883"  # Bambulab
      - "9100:9100"  # Printer
      - "1900:1900/udp"  # SSDP
      - "8991:8991/udp"  # Discovery
    expose:
      - "322"  # Intern für RTSP
      - "554"  # Intern für RTSP
    restart: unless-stopped
    tty: true  # Wichtig für interaktiven Modus
    stdin_open: true  # Wichtig für interaktiven Modus

  rtsp-proxy:
    container_name: rtsp-proxy
    image: bluenviron/mediamtx:1.0.0  # Spezifische Version
    networks:
      - printer-network
    ports:
      - "322:322"  # Bambulab RTSP (nach außen)
      - "554:554"  # Standard RTSP (nach außen)
    volumes:
      - ./mediamtx.yml:/mediamtx.yml
    depends_on:
      - mock-printer
    restart: unless-stopped

networks:
  printer-network:
    driver: bridge 